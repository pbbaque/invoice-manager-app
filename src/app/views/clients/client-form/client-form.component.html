<div class="page">
  <app-alert
    [message]="errorMessage"
    type="error"
    [visible]="errorVisible"
    (closed)="errorVisible = false"
  >
  </app-alert>
  <div class="page__header">
    <h2 class="page__name">
      {{ isEditMode ? "Editar Cliente" : "Nuevo Cliente" }}
    </h2>
    <p class="page__description">
      {{
        isEditMode
          ? "Aquí puedes modificar los datos del cliente."
          : "Aquí puedes registrar un nuevo cliente en el sistema."
      }}
    </p>
  </div>

  <div class="page__content">
    <form class="form" [formGroup]="clientForm" (ngSubmit)="onSubmit()">
      <div class="form__content">
        <div class="form__group--row">
          <div class="form__field">
            <label for="name" class="form__label">Nombre</label>
            <input
              type="text"
              class="form__input"
              placeholder="Tu Nombre"
              id="name"
              formControlName="name"
            />
            <small class="form__error" *ngIf="name?.touched && name?.invalid">
              <span *ngIf="name?.errors?.['required']"
                >El nombre es obligatorio</span
              >
              <span *ngIf="name?.errors?.['name']"
                >Formato de nombre inválido</span
              >
            </small>
          </div>

          <div class="form__field">
            <label for="lastname" class="form__label">Apellido</label>
            <input
              type="text"
              class="form__input"
              placeholder="Tu Apellido"
              id="lastname"
              formControlName="lastname"
            />
            <small
              class="form__error"
              *ngIf="lastname?.touched && lastname?.invalid"
            >
              <span *ngIf="lastname?.errors?.['required']"
                >El apellido es obligatorio</span
              >
              <span *ngIf="lastname?.errors?.['lastname']"
                >Formato de apellido inválido</span
              >
            </small>
          </div>
        </div>
        <div class="form__group--row">
          <div class="form__field">
            <label for="email" class="form__label">Email</label>
            <input
              type="email"
              class="form__input"
              placeholder="Tu Email"
              id="email"
              formControlName="email"
            />
            <small class="form__error" *ngIf="email?.touched && email?.invalid">
              <span *ngIf="email?.errors?.['required']"
                >El email es obligatorio</span
              >
              <span *ngIf="email?.errors?.['email']"
                >Formato de email inválido</span
              >
            </small>
          </div>

          <div class="form__field">
            <label for="phone" class="form__label">Telefono</label>
            <input
              type="number"
              class="form__input"
              placeholder="Tu Telefono"
              id="phone"
              formControlName="phone"
            />
            <small class="form__error" *ngIf="phone?.touched && phone?.invalid">
              <span *ngIf="phone?.errors?.['required']"
                >El telefono es obligatorio</span
              >
              <span *ngIf="phone?.errors?.['phone']"
                >Formato de telefono inválido</span
              >
            </small>
          </div>
        </div>
        <div formGroupName="address">
          <h3 class="text-center form__label address">Dirección</h3>

          <div class="form__group--row">
            <div class="form__field">
              <label for="street" class="form__label">Calle</label>
              <input
                type="text"
                class="form__input"
                placeholder="Calle"
                id="street"
                formControlName="street"
              />
              <small
                class="form__error"
                *ngIf="
                  address?.get('street')?.touched &&
                  address?.get('street')?.invalid
                "
              >
                <span *ngIf="address?.get('street')?.errors?.['required']"
                  >La calle es obligatoria</span
                >
              </small>
            </div>

            <div class="form__field">
              <label for="number" class="form__label">Codigo Postal</label>
              <input
                type="text"
                class="form__input"
                placeholder="Número"
                id="number"
                formControlName="number"
              />
              <small
                class="form__error"
                *ngIf="
                  address?.get('number')?.touched &&
                  address?.get('number')?.invalid
                "
              >
                <span *ngIf="address?.get('number')?.errors?.['required']"
                  >El número es obligatorio</span
                >
              </small>
            </div>
          </div>

          <div class="form__group--row">
            <div class="form__field">
              <label for="city" class="form__label">Ciudad</label>
              <input
                type="text"
                class="form__input"
                placeholder="Ciudad"
                id="city"
                formControlName="city"
              />
              <small
                class="form__error"
                *ngIf="
                  address?.get('city')?.touched && address?.get('city')?.invalid
                "
              >
                <span *ngIf="address?.get('city')?.errors?.['required']"
                  >La ciudad es obligatoria</span
                >
              </small>
            </div>

            <div class="form__field">
              <label for="country" class="form__label">País</label>
              <input
                type="text"
                class="form__input"
                placeholder="País"
                id="country"
                formControlName="country"
              />
              <small
                class="form__error"
                *ngIf="
                  address?.get('country')?.touched &&
                  address?.get('country')?.invalid
                "
              >
                <span *ngIf="address?.get('country')?.errors?.['required']"
                  >El país es obligatorio</span
                >
              </small>
            </div>
          </div>
        </div>
        <div *ngIf="isAdmin" class="form__field" formGroupName="company">
          <label for="companyId" class="form__label">Compañía</label>
          <select id="companyId" class="form__input" formControlName="id">
            <option value="" disabled>Seleccione una compañía</option>
            <option *ngFor="let company of companies" [value]="company.id">
              {{ company.name }}
            </option>
          </select>
          <small
            *ngIf="company?.get('id')?.touched && company?.get('id')?.invalid"
            class="form__error"
          >
            <span *ngIf="company?.get('id')?.errors?.['required']"
              >La compañía es obligatoria</span
            >
          </small>
        </div>
      </div>
      <div class="form__group--row">
        <input
          type="submit"
          class="form__submit"
          [value]="isEditMode ? 'Guardar Cambios' : 'Registrar Cliente'"
        />
        <input
          type="button"
          class="form__return"
          value="Volver"
          (click)="goBack()"
        />
      </div>
    </form>
  </div>
</div>
